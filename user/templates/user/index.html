{% load staticfiles %}
<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="utf-8">
	<meta name="baidu-site-verification" content="ucoHEaVHET" />
	<title>我的航班</title>
	
	<meta name="viewport" content="width=device-width,
                                     initial-scale=1.0,
                                     maximum-scale=1.0,
                                     user-scalable=no">
	<link rel="stylesheet" href="{% static 'css/widget_new.css'%}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/calendar.css'%}"/>
	<script src="{% static 'js/jquery.min.js'%}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/jquery-1.js'%}"></script>
	

	 <style>
        * { padding: 0; margin: 0 auto; }
        table {
            border-collapse: collapse;
            border-spacing: 0;
            border: 1px solid #c0c0c0;
        }

        th,td {
            border: 1px solid #d0d0d0;
            color: #404060;
            padding: 10px;
        }

        th {
            background-color: #09c;
            font: bold 16px "微软雅黑";
            color: #fff;
        }

        td {
            font: 14px "微软雅黑";
        }
        tbody tr {
            background-color: #f0f0f0;
        }
        tbody tr:last-child:hover {
            background-color: #fafafa;
        }
    </style>

</head>
<body >
	<div class="usernamer_login">
		<div class="header" >
			<div class="topMenu clearfix">
				<ul class="menu item pull-left">
					<li class="top-menu-item  top-menu-curr ">
						<a href="/airplane/index/" class="menu-hd"><span>首页</span></a>
					</li>
					<li class="top-menu-item ">
						<a href="/airplane/trip/" class="menu-hd"><span>出行管理</span></a>
					</li>
					<li class="top-menu-item   ">
						<a href="/user/login/" class="menu-hd cur_pointer"><span>登录/注册</span></a>
					</li>
				</ul>
			</div>
		</div>
	</div>

    <div id="my_header" style="background-color: #88b7e4">
        <div id="my_blank" style="padding-top: 115px"></div>
        <div>
            <p style="text-align: center;font-size: 54px;">我的航班</p>
            <p style="text-align: center;font-size:20px;margin: 40px">航班查询</p>
        </div>
    </div>
    <div >
        <ul id="myTab" class="nav nav-tabs" style=" margin: 30px auto; ">
            <li class="active" style=" margin: 0 auto; ">
                <a href="#searchByNumber" data-toggle="tab" >
                 航班号查询
                </a>
             </li>
            <li style=" margin: 0 auto; ">
                <a href="#searchByCity" data-toggle="tab" >
                    起降地查询
                </a>
            </li>
        </ul>
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade in active" id="searchByNumber">
                        <form id="findFlightByNum" name="flight_form" >
                            <div class="form_row" style="display: inline">
                                <div class="col2" style="display: inline ;margin-left: 300px">
                                    <input style="width: 250px" type="text" class="input" id="flightNo" name="flightNo" value="" placeholder="请输入航班号">
                                </div>
                                <div class="col1" style="display: inline ;margin-left: 240px">出发时间：</div>
                                <div class="col2" style="display: inline">
                                    <input type="date" id="takeoffDate2" name="takeoffDate2" class="input"  style="width:180px;">&nbsp;
                                </div>
                            </div>
                            <div class="col3" style="display: inline ;margin-left: 100px">
                                    <input type="button" value="查 询" id="findFlightByNum_0" class="button" onclick="id_search()">
                            </div>
                        </form>
                    </div>
            <div class="tab-pane fade" id="searchByCity">
                        <form id="findFlightByDate" name="date_form" >
                            <div class="form_row" style="display: inline">
                                <div class="col2" style="display: inline ;margin-left: 300px">
                                    <input value="" id="sl_start" autocomplete="off" type="text" class="input_city"style="background-color: rgba(255,255,255,0.3)" placeholder="输入出发城市">
                                </div>
                                <div class="col2" style="display: inline; margin:0px 60px;">
                                    <input value="" id="sl_end" autocomplete="off" type="text" class="input_city" style="background-color: rgba(255,255,255,0.3)" placeholder="输入目的城市">
                                </div>
                            </div>
                            <div class="form_row" style="display: inline">
                                <div class="col1" style="display: inline">出发时间：</div>
                                <div class="col2" style="display: inline">
                                    <input type="date" id="takeoffDate1" name="takeoffDate1" class="input" style="width:180px;">
                                </div>
                            </div>
                            <div class="form_row" style="display: inline">
                                <div class="col3" style="display: inline;margin-left: 100px" >
                                    <input type="button" value="查 询" id="findFlightByDate_0" class="button" onclick="search_onclick()">
                                </div>
                            </div>
                        </form>
            </div>
        </div>
    </div>
    <div id="container_demo" >

    </div>
<script type="text/javascript" language="javascript" src="{% static 'js/cookieUtils.js'%}"></script>
<script language="javascript">
var searchType = "trip";
jQuery(document).ready(function() {
	jQuery("#flight_search_form").hide();
    jQuery("#per_flight").click(function() {
    	tab_closeCalendar();
    	CookieUtils.query("FLIGHT");
    	
        jQuery("#date_search_form").hide();
        jQuery("#flight_search_form").show();
    });


    jQuery("#per_date").click(function() {
    	tab_closeCalendar();
    	CookieUtils.query("TRIP");
    	
        jQuery("#flight_search_form").hide();
        jQuery("#date_search_form").show();
    });
});
function tab_closeCalendar(){
	if(document.getElementById('yearDropDown')!=null){
		closeCalendar();
	}
}
</script>




<script>
	var data1;
		function id_search()
		{
	        var flight_number=$('#flightNo').val();

            var  my_data ;
            my_data= $('#takeoffDate2').val();
	        $.get("/airplane/getSearchFlightById/?flight_id="+flight_number+"&datetime="+my_data+"&is_detail="+0+"&detail_url="+"--",function(data,status){
				if(data.is_exist==1)
						printfight(data.flight,0);
				else{
						$('#container_demo').html('不存在');
					}
	        });		
		}
		function search_onclick()
        	{
        		var date3=$('#takeoffDate1').val();
        		var begin=$('#sl_start').val();
        		var end=$('#sl_end').val();
        		$.get("/airplane/getSearchFlightByCity/?city_from="+begin+"&city_to="+end+"&datetime="+date3+"&is_detail="+0+"&detail_url="+"--",function(data,status){
        		    console.log(data);
					if(data.is_exist==1)
					{
						printfight(data.flight,1);
					}
					else{
						alert("航班不存在")
					}
        		});
        	}
        	
        function printfight(data,type)//type==0 by id     type ==1 by city
        {
        	data1=data;
        	$('#container_demo').empty();
        	$('#container_demo').append('<table id="mytable"> <tr> <th>航班信息</th> <th>计划起飞</th> <th>实际起飞</th> <th>出发地</th> <th>计划到达</th> <th>实际到达</th> <th>到达地</th> <th>准点率</th> <th>状态</th> <th>添加行程</th> <th>查看详情</th> </tr> </table>');
        	var i,j;
        	for(i=0;i<data.length;i++)
        	{
        		var $trTemp = $("<tr></tr>");
        		$trTemp.append("<td>"+ data[i].flight_id +"</td>");
        		$trTemp.append("<td>"+ data[i].plan_departure_time +"</td>");
        		$trTemp.append("<td>"+ data[i].actual_departure_time +"</td>");
        		$trTemp.append("<td>"+ data[i].departure +"</td>");
        		$trTemp.append("<td>"+ data[i].plan_arrival_time +"</td>");
        		$trTemp.append("<td>"+ data[i].actual_arrival_time +"</td>");
        		$trTemp.append("<td>"+ data[i].arrival +"</td>");
        		$trTemp.append("<td>"+ data[i].punctuality_rate +"</td>");
        		$trTemp.append("<td>"+ data[i].flight_status +"</td>");
        		$trTemp.append("<td >"+"<input type='button' value='添加行程' onclick='trip("+i+type+")' />" +"</td>");
        		$trTemp.append("<td >"+"<input type='button' value='查看详情' onclick='detail("+i+type+")' />" +"</td>");
        		$trTemp.appendTo("#mytable");
        	}
        }
		 function detail(id,type)
        {
            if(type==0)
            {
                $.get("/airplane/getSearchFlightById/?flight_id="+flight_number+"&datetime="+my_data+"&is_detail="+1+"&detail_url="+data1[id].detail_url,function(data,status){
                    printfdetail(data);
                })
            }
            else
            {
                $.get("/airplane/getSearchFlightByCity/?city_from="+begin+"&city_to="+end+"&datetime="+date3+"&is_detail="+1+"&detail_url="+data1[id].detail_url,function(data,status){
                    printdetail(data);
                })
            }
		}
		function printdetail(data)
        {
           for(x in data)
            {
                if(data[x]=="")
	        		{
	        			data[x]="未知";
	        		}
	        }
            var searchUrl = encodeURI("/airplane/detail/?searchText=" + data.flight_id+' '+data.company+' '+data.real_flight_id+' '+data.datetime+' '+data.plan_departure_time+' '+data.plan_arrival_time+' '+data.actual_departure_time+' '+data.actual_arrival_time+' '+data.flight_status+' '+data.departure+' '+data.arrival+' '+data.punctuality_rate+' '+data.delay_time+' '+data.check_in+' '+data.boarding_port+' '+data.arriving_port+' '+data.Baggage_num+' '+data.length+' '+data.time+' '+data.proc+' '+data.plane+' '+data.age+' '+data.forecast+' '+data.old_state+' '+data.d_weather+' '+data.d_pm+' '+data.d_state+' '+data.a_weather+' '+data.a_pm+' '+data.a_state+' '+data.detail_url); //使用encodeURI编码
		    location.href = searchUrl;
        }
		function trip(id,type)
        {

        }
	//	alert(124);
</script>
</body>
</html>
